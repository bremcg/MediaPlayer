<!--
Name: Liz Baker, Breanna McGovern
Date: 4/8/2014
File: index.html
Description: The main index for our music player
-->
<!DOCTYPE html>
<html>
    <head>
        <title>A Music Player</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">  
        <link rel="stylesheet" type="text/css" href="style.css" />
        <link href='http://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>
        <script src="js/jquery-2.0.3.min.js"></script>   
        <script src="js/main.js"></script>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/handlebars-v1.3.0.js"></script>
        <script type="text/javascript" src="js/underscore-min.js"></script>        
    </head>
    <body>

        <div id="container">        
            <div id="banner">
                <h1>BreLiz Playlist</h1>

                <div id="nav"><!--navDiv-->
                    <ul class="nav">
                        <li id="genresBtn" class="navBtn">Genre</li>
                        <li class="subMenu">
                            <p>Rock</p>
                        </li><!--options-->

                        <li id="albumsBtn" class="navBtn">Albums</li>
                        <li class="subMenu">
                            <p>Albums and songs in Music Player</p>
                        </li><!--options-->

                        <li id="artistsBtn" class="navBtn">Artist</li>
                        <li class="subMenu">
                            <p>An option goes here.</p> 
                        </li><!--options-->
                    </ul>
                </div><!--end navDiv-->
            </div><!-- end banner and nav elements -->

            <div id="musicPlayer">
                <img src="daybreak/_screenshot.png" />
                <audio preload="auto" tabindex="0" autoplay="" loop=""></audio>
            </div><!--end musicPlayer-->               

            <!-- content goes here.. -->
            <div id="content">
                <div id="data">
                    <!--This will display either Genre Type, Album Name, or Artist Name-->
                    <!-- start of an experiment to slide the option to the left-->
                    <div id="contentSubOne">
                        <div id="genres"></div>
                        <div id="albums"></div>
                        <div id="artists"></div>
                        <div id="browse"></div> <!-- this div will display to the right with more info -->
                    </div>
                    <!-- <div id="contentSubTwo">
                         <div id="browse"></div>
                     </div>-->

                    <div id="info"></div>

                    <!--clear floats and whatever-->
                    <div style="clear:both; width:100%" ></div>

                    <!--Search--> 
                    <div id="search">
                        <div>Search for</div>
                        <div>Title: <input id="txtSearch" /></div>
                        <div><input id="btnSearch" type="button" value="search" /></div>
                    </div>
                </div><!-- end #data -->
            </div><!-- end #content -->



        </div><!-- end #container -->

        <script id="homePage" type="text/x-handlebars-template">
            Its {{name}}! Just listening to music and stuff.
        </script>   
        <!-- home jpage list of albums template -->
        <script id="albumHomeLinks" type="text/x-handlebars-template">
            <ul class="album_list">
            {{#each albums}}
            <li class="albumLink" data-id="{{this.id}}">
            {{this.artist}}
            {{this.title}}
            {{this.date}}
            {{this.image}}
            </li>
            {{/each}}	
            </ul>
        </script>        

        <!-- home jpage list of albums template -->
        <script id="albumLinks" type="text/x-handlebars-template">
            <ul class="album_list">
            {{#each albums}}
            <li class="albumLink" data-id="{{this.id}}">
            {{this.artist }} -
            {{this.title}} -
            {{this.date}} - 
            {{this.image}}
            </li>
            {{/each}}	
            </ul>
        </script>          

        <!-- genre links -->
        <script id="genreLinks" type="text/x-handlebars-template">
            <ul class="genre_links">
            {{#each this}}
            <li class="genreLink">{{this}}</li>
            {{/each}}
            </ul>
        </script>

        <!-- album info template -->
        <script id="albumInfo" type="text/x-handlebars-template">
            <div>
            <div class="albumArtist">{{artist}}</div> 
            <div class="albumTitle">{{title}}</div>
            <div class="albumDate">{{date}}</div>
            </div>
        </script>      

        <!-- album info template -->
        <script id="artistLinks" type="text/x-handlebars-template">
            <ul class="artist_links">
            {{#each this}}
            <li class="artistLink">{{this}}</li>
            {{/each}}
            </ul>
        </script>        

        <!-- page script -->
        <script>
var albums;
var tracks;

$(document).ready(function() {
    //this is for the nav to go to different fragments pages..
    $("#genresBtn").click(function() {
        $.get(
                "fragments/index.html",
                function(data) {
                    $("#content").html(data);
                    window.location.hash = "genres";
                })
    })
    //this is for the nav
    $("#albumsBtn").click(function() {
        $.get(
                "fragments/albums.html",
                function(data) {
                    $("#content").html(data);
                    window.location.hash = "albums";
                })
    })
    //this is for the nav                
    $("#artistsBtn").click(function() {
        $.get(
                "fragments/artists.html",
                function(data) {
                    $("#content").html(data);
                    window.location.hash = "artists";
                })
    })

    //get the window's hash value
    var hashVal = "fragments/" + window.location.hash + ".html";
    hashVal = hashVal.replace("#", "");
    console.log(hashVal);

    if (window.location.hash == "") {
        // hashVal = "fragments/index.html";
        hashVal = "fragments/index.html";
    }

    $.get(
            hashVal,
            function(data) {
                console.log(data);
                $("#content").html(data);

            })

    //this is for the nav, toggle class
    //  $('.menu').hide();
    //  $('.nav li').toggle(function() {
    //       $(this).next('.menu').fadeIn();
    //$(this).addClass('close');
    //   },
    //this is for the nav
    //                 function() {
    //                     $(this).next('.nav li').fadeOut();
    //$(this).removeClass('close');
    //                 }); // end toggle



    //this is to toggle subMenu2 to display the genres, albums, and artist when the main nav btns are clicked..
    //create variable to display data (GENRE, ALBUM, ARTIST) from JSON file in the content div from the JSON file.
    // var dataDiv = $("#genres");//put content div here where genres will display.

    //create variable to display data (SONGS, OTHER DATA) from JSON file in the content div
    //   var subDataDiv = $("#browse");


    //get the data from the JSON file to display with AJAX
    //use the variable above to put into content divs..
    //          $.getJSON('data.json', function(data) {
    //what'd we get?
    //              console.log("data");

    //              var tracks = data.albums[0].tracks;
    //              for (var i = 0; i < tracks.length; i++) {
    //                  dataDiv.append("<li>"
    //                          + tracks[i]
    //                          + "</li>"
    //                          );
    //              }

    //         });
    //manipulate how the data is then displayed below using jQuery toggle the menus once clicked..
    //we click on a nav menu option and genres, albums and artists toggle down in content div here
    // $('#genres').hide();
    //$('#contentSubOne').show();
    $('.subMenu').hide();//hides the nav sub Menus

    //click on navBtn and the data displays
    $('#genresBtn').click(function() {
        $('#genres').slideToggle(300);//menu slides down
        //  $('#genres').fadeIn('slow');//menu slides down
        $(this).toggleClass('close');
        if ($(this).togglClass('close')) {
            $('#browse').fadeOut();//closing the songs once the genres fadeout  
        }
        ;
    });//end toggle?

    //click on AlbumsBtn and the data display
    $('#albumsBtn').click(function() {
        $('#albums').slideToggle(300);//menu slides down
        $(this).toggleClass('close');
    })

    //click on artistBtn and the data display
    $('#artistBtn').click(function() {
        $('#artists').slideToggle(300);//menu slides down
        $(this).toggleClass('close');
    })
    //  $('#nav .nav .navBtn').toggle(function()
    // {
    //      $(this).next('#contentSubOne #genres').fadeIn();
    //  },
    //        function()
    //        {
    //           $(this).next('#contentSubOne #genres').fadeOut();
    //        });
//below starts getting information from JSON file                    

    //cached DOM references
    var infoDiv = $("#info");
    var browseDiv = $("#browse");
    var genreDiv = $("#genres");
    var albumsDiv = $("#albums");
    var artistDiv = $("#artists");


    //templates
    var hompageTemplate = Handlebars.compile($("#homePage").html());
    var albumLinkTemplate = Handlebars.compile($("#albumHomeLinks").html());
    var albumInfoTemplate = Handlebars.compile($("#albumInfo").html());
    var genreLinkTemplate = Handlebars.compile($("#genreLinks").html());
    var albumLinkTemplate = Handlebars.compile($("#albumLinks").html());
    //var artistLinkTemplate = Handlebars.compile($("#artistLinks").html());
    //var artistInfoTemplate = Handlebars.compile($("#artistInfo").html());


    $.getJSON('data/data.json', function(data) {
        albums = data.albums;
        image = data.albums.image;
        $("#content").append(albumLinkTemplate(data));
        genreDiv.html(genreLinkTemplate(data.genres));
        albumsDiv.html(albumLinkTemplate(data.albums));
        artistDiv.html(artistLinkTemplate(data.artist));
    })


    //Run this function whenever a element with class 'albumLink' is clicked if its in the content div, works for any now or in the future
    $("#albums").on("click", ".albumLink", function() {
        var albumInfo = _.findWhere(albums, {id: $(this).data('id')})
        albumsinfoDiv.html(albumInfoTemplate(albumInfo));
        console.log(albums[$(this).data('id')]);


        //get the data
        var templateData = albums[$(this).data('id')]
        //generate html
        var toAdd = albumInfoTemplate(templateData);
        //show in infor div
        infoDiv.html(toAdd);

        //infoDiv.html(bookInfoTemplate(books[$(this).data('id')]));
    })



    $("#genres").on("click", ".genreLink", function() {
        var genreToFind = $(this).html();
        var results = {};

        results.albums = _.where(albums, {genre: genreToFind});

        browseDiv.html(albumLinkTemplate(results));
    })

    $("#btnSearch").click(function() {
        //get the search term
        var searchTerm = $("#txtSearch").val();
        //object to store any results
        var results = {
            albums: []
        }

        //loop through all of our albums
        results.albums = _.filter(albums, function(item) {
            //return (item.title.indexOf(searchTerm) != -1);
            var titleSplit = item.title.split(" ");
            return _.find(titleSplit, function(titleWord) {
                return titleWord.toUpperCase() == searchTerm.toUpperCase();
            })
        })
        /*for(var i = 0; i < books.length; i++) {
         //split the book's name into individual words
         var titleSplit = books[i].title.split(" ");
         
         //loop through those words
         for(var y = 0; y < titleSplit.length; y++) {
         if(titleSplit[y].toUpperCase() == searchTerm.toUpperCase()) {
         results.books.push(books[i]);
         break;
         }
         }
         }*/

        browseDiv.html(albumLinkTemplate(results));

    })
})
        </script>        
    </body>
</html>
